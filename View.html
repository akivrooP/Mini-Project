<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>IPL Database - View Tables - Dynamic</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600&display=swap');
  body {
    background: linear-gradient(135deg, #004e92, #000428);
    font-family: 'Plus Jakarta Sans', sans-serif;
    color: #e1eaff;
    margin: 0;
    min-height: 100vh;
    padding: 2rem;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }
  .container {
    background: #112d4e;
    border-radius: 14px;
    max-width: 1000px;
    width: 100%;
    box-shadow: 0 6px 25px rgba(0,0,0,0.6);
    padding: 2rem 2rem 3rem 2rem;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    font-weight: 700;
    margin: 1rem 0 1.5rem 0;
    color: #cce3f2;
    text-shadow: 0 2px 5px rgba(0,0,0,0.5);
    text-align: center;
  }
  .logo-container img {
    width: 100px;
    filter: drop-shadow(0 0 5pxrgb(0, 0, 0));
  }
  label {
    align-self: flex-start;
    font-weight: 600;
    margin-bottom: 0.3rem;
    color: #a8bbd3;
  }
  select, input[type="text"] {
    width: 100%;
    max-width: 300px;
    padding: 0.5rem 0.8rem;
    font-size: 1rem;
    border-radius: 8px;
    border: none;
    outline: none;
    margin-bottom: 1.2rem;
    transition: box-shadow 0.3s ease;
  }
  select:focus, input[type="text"]:focus {
    box-shadow: 0 0 10px #66b1ff;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: #1e3a8a;
    border-radius: 10px;
    overflow: hidden;
    user-select: none;
  }
  thead {
    background: #284b8a;
  }
  th, td {
    padding: 12px 15px;
    border-bottom: 1px solid #2f4e9b;
    text-align: left;
    font-weight: 500;
  }
  th {
    color: #d0e1ff;
    font-weight: 700;
    cursor: pointer;
  }
  th.sorted-asc::after,
  th.sorted-desc::after {
    content: "";
    position: absolute;
    right: 10px;
    top: 50%;
    border: 6px solid transparent;
    transform: translateY(-50%);
  }
  th.sorted-asc::after {
    border-bottom-color: #d0e1ff;
  }
  th.sorted-desc::after {
    border-top-color: #d0e1ff;
  }
  tbody tr:hover {
    background: #3a5abd;
  }
  .no-data {
    color: #ffbaba;
    font-style: italic;
    text-align: center;
    padding: 1rem 0;
  }
  .footer {
    margin-top: 2rem;
    font-size: 0.9rem;
    text-align: center;
    color: #8cacd9;
  }
</style>
</head>
<body>
  <div class="container">
    <div class="logo-container">
      <img src="{{ url_for('static', filename='images/IPL-Logo.avif') }}" alt="Indian Premier League Logo" />
    </div>
    <h1>IPL Database - View Tables</h1>

    <label for="tableSelect">Select Table to View:</label>
    <select id="tableSelect">
      <option value="" disabled selected>Select</option>
      <option value="player">Player</option>
      <option value="team">Team</option>
      <option value="playerstats">Player Stats</option>
      <option value="match_stats">Match Stats</option>
      <option value="stadium">Stadium</option>
      <option value="matches">Matches</option>
      <option value="winners">Winners</option>


    </select>

    <label for="searchInput" style="margin-top:-0.5rem; margin-bottom: 0.8rem;">Type to search/filter the table below</label>
    <input type="text" id="searchInput" placeholder="Search in table..." disabled />

    <div id="tableContainer"></div>

    <div class="footer">IPL Database Viewer &copy; 2024</div>
  </div>

<script>
  const tableSelect = document.getElementById('tableSelect');
  const tableContainer = document.getElementById('tableContainer');
  const searchInput = document.getElementById('searchInput');

  let currentTableData = [];
  let currentSortColumn = null;
  let currentSortAsc = true;

  tableSelect.addEventListener('change', async () => {
    const selectedTable = tableSelect.value;
    if (!selectedTable) {
      tableContainer.innerHTML = '';
      searchInput.value = '';
      searchInput.disabled = true;
      return;
    }

    try {
      const response = await fetch('/ipl/display_table', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ table_name: selectedTable })
      });

      const data = await response.json();
      currentTableData = data;
      currentSortColumn = null;
      currentSortAsc = true;
      searchInput.value = '';
      searchInput.disabled = false;
      renderTable(currentTableData);
    } catch (error) {
      console.error('Error fetching table data:', error);
      tableContainer.innerHTML = `<p class="no-data">Error loading data.</p>`;
    }
  });

  searchInput.addEventListener('input', () => {
    const term = searchInput.value.toLowerCase();
    const filteredData = currentTableData.filter(row =>
      Object.values(row).some(val =>
        String(val).toLowerCase().includes(term)
      )
    );
    renderTable(filteredData);
  });

  function renderTable(data) {
    if (!data.length) {
      tableContainer.innerHTML = `<p class="no-data">No data available.</p>`;
      return;
    }

    const table = document.createElement('table');
    const thead = document.createElement('thead');
    const tbody = document.createElement('tbody');

    const headers = Object.keys(data[0]);
    const trHead = document.createElement('tr');

    headers.forEach(header => {
      const th = document.createElement('th');
      th.textContent = toTitleCase(header.replace(/_/g, ' '));
      th.addEventListener('click', () => sortTableByColumn(header));
      if (header === currentSortColumn) {
        th.classList.add(currentSortAsc ? 'sorted-asc' : 'sorted-desc');
      }
      trHead.appendChild(th);
    });
    thead.appendChild(trHead);

    data.forEach(row => {
      const tr = document.createElement('tr');
      headers.forEach(header => {
        const td = document.createElement('td');
        td.textContent = row[header];
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    });

    table.appendChild(thead);
    table.appendChild(tbody);
    tableContainer.innerHTML = '';
    tableContainer.appendChild(table);
  }

  function sortTableByColumn(column) {
    if (!currentTableData.length) return;
    if (currentSortColumn === column) {
      currentSortAsc = !currentSortAsc;
    } else {
      currentSortColumn = column;
      currentSortAsc = true;
    }

    currentTableData.sort((a, b) => {
      let valA = a[column];
      let valB = b[column];
      if (typeof valA === 'string') valA = valA.toLowerCase();
      if (typeof valB === 'string') valB = valB.toLowerCase();
      if (valA < valB) return currentSortAsc ? -1 : 1;
      if (valA > valB) return currentSortAsc ? 1 : -1;
      return 0;
    });

    renderTable(currentTableData);
  }

  function toTitleCase(str) {
    return str.replace(/\w\S*/g, txt =>
      txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
    );
  }
</script>
</body>
</html>
